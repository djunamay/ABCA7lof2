# mRNA-sequencing on induced Neurons

## Experiment Overview
**RNA Extraction, Library Preparation, and Sequencing**
Total RNA was extracted from iNs using the RNeasy Mini Kit (Qiagen), and RNA quality was assessed on a 5300 Fragment Analyzer (Agilent). Only samples with an RNA Quality Number (RQN) > 9.5 were carried forward for library preparation. Full-length cDNA was synthesized with the SMART-seq v4 Kit (Takara Bio), and sequencing libraries were generated using the Nextera XT DNA Library Preparation Kit (Illumina). Libraries were sequenced as 75 bp + 75 bp paired-end reads with dual 8-nt indexes on an Element AVITI platform (Element Biosciences) at the MIT BioMicro Center.

**Bulk mRNA Sequencing Data Processing**
Sequencing data were processed using the BMC/BCC pipeline version 1.8 (updated 06/06/2023). Further details of the pipeline are available at the MIT BioMicro Centerâ€™s [BMC-BCC Pipeline](https://openwetware.org/wiki/BioMicroCenter:Software#BMC-BCC_Pipeline). FASTQ files were then processed in-house using STAR for splice-aware mapping and featureCounts.

The human reference genome (GRCh38.p14, GENCODE release 47) and annotation files were downloaded from GENCODE and indexed with STAR using its recommended parameters. Reads were trimmed using Trim Galore with Nextera-specific settings and a stringency of 3 (requiring at least 3-base overlap with adapter sequences). Trimmed paired-end reads were mapped to the indexed genome with STAR, processing both mates simultaneously.

Gene-level counts were generated by featureCounts with settings optimized for paired-end data:

* `-B`: count only read pairs with both ends aligned
* `-C`: exclude pairs mapping to different chromosomes or strands
* `-p`: count fragments rather than individual reads

Counts were summarized at the exon level and then aggregated by gene identifier.

## Data availability
- Raw data will be available via the Gene Expression Omnibus under accession ID [GSE219999]()
- Processed data are available via [OSF: /mRNAseq_iN_processed_intermediate](https://osf.io/mnysb/files/osfstorage)
  
## Code Overview
- Run `get_reference.sh` to download the GRCh38 primary assembly FASTA and GENCODE v47 GTF  
- Run `make_index.sh` to generate the genome index for splice-aware mapping
- Run `trim.sh` to perform adapter trimming
- Run `mapping.sh` to align trimmed FASTQs to GRCh38 using STAR 
- Run `featurecounts.sh` to count exon-level reads with featureCounts  
- Run `computing_degs.ipynb` to calculate differentially-expressed genes
- Run `compute_ffcv.ipynb` to calculate pathway enrichments using FGSEA
- Run `run_partitioning_bulkRNAseq.py` to partition the gene-pathway graphs for each comparison
- Run `KL_bulk_clean.ipynb` to plot the partitioning outputs
- Run `rna_seq_plots.ipynb` for other RNAseq plots in the paper
